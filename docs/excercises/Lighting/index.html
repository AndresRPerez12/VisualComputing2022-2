<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Excercises: Lighting # Background # Lighting aims at modelling light interactions on different material types to simulate both, photorealistic and non-photorealistic scenes. What the virtual camera sees in a scene is the result of light from a lightsource bouncing off an object and then going to the eye. To understand and emulate the interaction of light with the rendered objects, we must understand the diffenet kinds of illumination models."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Excercises: Lighting # Background # Lighting aims at modelling light interactions on different material types to simulate both, photorealistic and non-photorealistic scenes. What the virtual camera sees in a scene is the result of light from a lightsource bouncing off an object and then going to the eye. To understand and emulate the interaction of light with the rendered objects, we must understand the diffenet kinds of illumination models."><meta property="og:type" content="article"><meta property="og:url" content="https://andresrperez12.github.io/VisualComputing2022-2/docs/excercises/Lighting/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-11-27T23:20:04-05:00"><title>Lighting | Visual Computing 2022-2</title><link rel=manifest href=/VisualComputing2022-2/manifest.json><link rel=icon href=/VisualComputing2022-2/favicon.png type=image/x-icon><link rel=stylesheet href=/VisualComputing2022-2/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/VisualComputing2022-2/flexsearch.min.js></script>
<script defer src=/VisualComputing2022-2/en.search.min.9b2d351bb41aa7ea0cb65e64c0d4c1986ec6930704dd3629ae9f7c95c8e1fa84.js integrity="sha256-my01G7Qap+oMtl5kwNTBmG7GkwcE3TYprp98lcjh+oQ=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/VisualComputing2022-2/><span>Visual Computing 2022-2</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-1ec4f879ff755259b18baf4fbdae0098 class=toggle checked>
<label for=section-1ec4f879ff755259b18baf4fbdae0098 class="flex justify-between"><a href=/VisualComputing2022-2/docs/excercises/>Excercises</a></label><ul><li><a href=/VisualComputing2022-2/docs/excercises/ColorBlendModes/>Color Blend Modes</a></li><li><a href=/VisualComputing2022-2/docs/excercises/ColorMultiplicationExcercise/>Color Multiplication Excercise</a></li><li><a href=/VisualComputing2022-2/docs/excercises/dither/>Dither</a></li><li><a href=/VisualComputing2022-2/docs/excercises/ImageProcessingExercise/>Image Processing Exercise</a></li><li><a href=/VisualComputing2022-2/docs/excercises/Lighting/ class=active>Lighting</a></li><li><a href=/VisualComputing2022-2/docs/excercises/Mosaic/>Mosaic</a></li><li><a href=/VisualComputing2022-2/docs/excercises/Rasterization/>Rasterization</a></li><li><a href=/VisualComputing2022-2/docs/excercises/SpatialCoherence/>Spatial Coherence</a></li><li><a href=/VisualComputing2022-2/docs/excercises/TerrainVisualizationApplication/>Terrain Visualization Application</a></li></ul></li><li><input type=checkbox id=section-9370f1a5d0248572ac505e0c6d4ad190 class=toggle>
<label for=section-9370f1a5d0248572ac505e0c6d4ad190 class="flex justify-between"><a href=/VisualComputing2022-2/docs/shortcodes/>Shortcodes</a></label><ul><li><a href=/VisualComputing2022-2/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/columns/>Columns</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/details/>Details</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/hints/>Hints</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/katex/>Katex</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between"><a href=/VisualComputing2022-2/docs/shortcodes/p5/>P5</a></label><ul><li><a href=/VisualComputing2022-2/docs/shortcodes/p5/div/>Div</a></li><li><a href=/VisualComputing2022-2/docs/shortcodes/p5/iframe/>Iframe</a></li></ul></li><li><a href=/VisualComputing2022-2/docs/shortcodes/tabs/>Tabs</a></li></ul></li><li><input type=checkbox id=section-bd592e6455531edb048edb6a320c69c4 class=toggle>
<label for=section-bd592e6455531edb048edb6a320c69c4 class="flex justify-between"><a href=/VisualComputing2022-2/docs/team/>Team</a></label><ul></ul></li><li><input type=checkbox id=section-191d4fa5967ce9fef74cb18feb81d534 class=toggle>
<label for=section-191d4fa5967ce9fef74cb18feb81d534 class="flex justify-between"><a href=/VisualComputing2022-2/docs/workshops/>Workshops</a></label><ul><li><a href=/VisualComputing2022-2/docs/workshops/3D_Application/>3 D Application</a></li><li><a href=/VisualComputing2022-2/docs/workshops/maskingWorkshop/>Masking Workshop</a></li><li><a href=/VisualComputing2022-2/docs/workshops/visualIllussionsWorkshop/>Visual Illussions Workshop</a></li></ul></li></ul><ul><li><a href=/VisualComputing2022-2/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/VisualComputing2022-2/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Lighting</strong>
<label for=toc-control><img src=/VisualComputing2022-2/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#excercises-lighting>Excercises: Lighting</a><ul><li><a href=#background>Background</a><ul><li><a href=#no-lighting-emissive-lighting>No Lighting (Emissive Lighting)</a></li><li><a href=#ambient-light>Ambient Light</a></li><li><a href=#point-light>Point Light</a></li><li><a href=#difuse-reflection>Difuse Reflection</a></li><li><a href=#specular-reflection>Specular Reflection</a></li></ul></li><li><a href=#code--results>Code & Results</a><ul><li></li></ul></li><li><a href=#code--results-1>Code & Results</a><ul><li></li></ul></li><li><a href=#code--results-2>Code & Results</a><ul><li></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=excercises-lighting>Excercises: Lighting
<a class=anchor href=#excercises-lighting>#</a></h1><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Lighting aims at modelling light interactions on different material types to simulate both, photorealistic and non-photorealistic scenes. What the virtual camera sees in a scene is the result of light from a lightsource bouncing off an object and then going to the eye. To understand and emulate the interaction of light with the rendered objects, we must understand the diffenet kinds of illumination models.</p><h3 id=no-lighting-emissive-lighting>No Lighting (Emissive Lighting)
<a class=anchor href=#no-lighting-emissive-lighting>#</a></h3><p>In this scenario, there are no light in the scene, and each object is self-luminous, since truly no lighting would be just a black scene. In this model, an object&rsquo;s color is not affected by anything else in the scene.</p><h3 id=ambient-light>Ambient Light
<a class=anchor href=#ambient-light>#</a></h3><p>In this model, there is a non-directional light source such that light has been refleceted so many times from so many different surfaces that it appers to come equally from all directions. Therefore, its intensity is constant over all polygons and is not affected by anything in the world. It can be colored, such that the color of each object interacts with the color of the ambient light.</p><h3 id=point-light>Point Light
<a class=anchor href=#point-light>#</a></h3><p>In this model, the lightsource is a point in space that gives off equal amounts of light in all directions. Polygons which are closer to the light appear brighter than those that are further away. The angle at which light from a point light source hits an object depends on the positions of both the object and the light source.</p><h3 id=difuse-reflection>Difuse Reflection
<a class=anchor href=#difuse-reflection>#</a></h3><p>In a diffuse reflection model, light from a point source is reflected with equal intensity in all directions, and its intensity depends on the anglw between the normal vector of the surface and the light ray from the point light. Light reflect of dull surfaces.</p><h3 id=specular-reflection>Specular Reflection
<a class=anchor href=#specular-reflection>#</a></h3><p>In a specular reflection model, light reflects of shiny surfaces in such a way that a highlight can be seen. The position of the eye or virtual camera is relevant since light bounces in a mirror-like fashion, in the same angle as it entered from the point light. If we take the angle in a discrete manner we can create a toon-like effect with discrete jumps in intensity.</p><blockquote class="book-hint info"><h3 id=ambient-light>Ambient light
<a class=anchor href=#ambient-light>#</a></h3><p><strong>Excercise</strong><br>Implement a scene having the following lighting equation: \mathbf{a} = ambient , ambient4a=ambientambient4, where ambient4ambient4 is the ambient light color. It should produce something like the sketch below:</blockquote><h2 id=code--results>Code & Results
<a class=anchor href=#code--results>#</a></h2><h4 id=code>Code
<a class=anchor href=#code>#</a></h4><p><details><summary>Ambient light</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>easycam</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>models</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>modelsDisplayed</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lightShader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ambient</span>, <span style=color:#a6e22e>ambient4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/VisualComputing2022-2/docs/excercises/ambient_color.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>500</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>textureMode</span>(<span style=color:#a6e22e>NORMAL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setAttributes</span>(<span style=color:#e6db74>&#39;antialias&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>300</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>0.285</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.257</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.619</span>, <span style=color:#ae81ff>0.685</span>],
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>.<span style=color:#a6e22e>INFO</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>state</span>, <span style=color:#ae81ff>2000</span>); <span style=color:#75715e>// now animate to that state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  document.<span style=color:#a6e22e>oncontextmenu</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorMode</span>(<span style=color:#a6e22e>RGB</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trange</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>models</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>push</span>(
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>position</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>createVector</span>((<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>25</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span>, <span style=color:#66d9ef>int</span>(<span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>), <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0.5</span>, <span style=color:#ae81ff>0.05</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>input</span>(() =&gt; { <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient&#39;</span>, <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>value</span>()) });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>lightShader</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient&#39;</span>, <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createColorPicker</span>(<span style=color:#e6db74>&#39;white&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>45</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ambient4Color</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>color</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient4&#39;</span>, [<span style=color:#a6e22e>red</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#a6e22e>green</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#a6e22e>blue</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient4&#39;</span>, [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#39;green&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>axes</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>value</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>color</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>position</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>box</span>(<span style=color:#a6e22e>radius</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>sphere</span>(<span style=color:#a6e22e>radius</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>torus</span>(<span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>radius</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><details><summary>Ambient light fragment shader</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#66d9ef>precision</span> <span style=color:#66d9ef>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>float</span> ambient;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec4</span> ambient4;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec4</span> uMaterialColor;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  gl_FragColor <span style=color:#f92672>=</span> ambient <span style=color:#f92672>*</span> ambient4 <span style=color:#f92672>*</span> uMaterialColor;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details></p><h4 id=execution>Execution
<a class=anchor href=#execution>#</a></h4><iframe id=breath style=width:530px;height:530px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/objetos/p5.quadrille.js/p5.quadrille.js></script>
            <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            
            
            
            
            
            <script>
              
let easycam;
let models;
let modelsDisplayed;
let lightShader;
let ambient, ambient4;

function preload() {
  lightShader = readShader('/VisualComputing2022-2/docs/excercises/ambient_color.frag', { varyings: Tree.NONE });
}

function setup() {
  createCanvas(500, 500, WEBGL);
  textureMode(NORMAL);
  noStroke();
  setAttributes('antialias', true);
  let state = {
    distance: 300,
    center: [0, 0, 0],
    rotation: [-0.285, -0.257, -0.619, 0.685],
  };
  console.log(Dw.EasyCam.INFO);
  easycam = new Dw.EasyCam(this._renderer);
  easycam.state_reset = state;   // state to use on reset (double-click/tap)
  easycam.setState(state, 2000); // now animate to that state
  document.oncontextmenu = function () { return false; }
  colorMode(RGB, 1);
  let trange = 100;
  models = [];
  for (let i = 0; i < 100; i++) {
    models.push(
      {
        position: createVector((random() * 2 - 1) * trange, (random() * 2 - 1) * trange, (random() * 2 - 1) * trange),
        size: random() * 25 + 8,
        color: color(random(), random(), random())
      }
    );
  }
  
  modelsDisplayed = createSlider(1, models.length, int(models.length / 4), 1);
  modelsDisplayed.position(10, 10);
  modelsDisplayed.style('width', '80px');
  ambient = createSlider(0, 1, 0.5, 0.05);
  ambient.position(420, 10);
  ambient.style('width', '80px');
  ambient.input(() => { lightShader.setUniform('ambient', ambient.value()) });
  shader(lightShader);
  lightShader.setUniform('ambient', ambient.value());
  ambient4 = createColorPicker('white');
  ambient4.position(420, 45);
  ambient4.input(() => {
    
    let ambient4Color = ambient4.color();
    lightShader.setUniform('ambient4', [red(ambient4Color) / 255, green(ambient4Color) / 255, blue(ambient4Color) / 255, 1]);
  });
  lightShader.setUniform('ambient4', [1, 1, 1, 1]);
}

function draw() {
  background(0);
  push();
  stroke('green');
  axes();
  grid();
  pop();
  for (let i = 0; i < modelsDisplayed.value(); i++) {
    push();
    fill(models[i].color);
    translate(models[i].position);
    let radius = models[i].size / 2;
    i % 3 === 0 ? box(radius * 2) : i % 3 === 1 ? sphere(radius) : torus(radius, radius / 4);
    pop();
  }
}

            </script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><blockquote class="book-hint info"><h3 id=toon-shading>Toon shading
<a class=anchor href=#toon-shading>#</a></h3><p><strong>Excercise</strong><br>Tweak the above diffuse shader to implement a toon shading scene. It should produce something like the sketch below:</blockquote><h2 id=code--results-1>Code & Results
<a class=anchor href=#code--results-1>#</a></h2><h4 id=code-1>Code
<a class=anchor href=#code-1>#</a></h4><details><summary>Toon shading</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>easycam</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>models</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>modelsDisplayed</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lightShader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>depth</span>, <span style=color:#a6e22e>ambient4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/VisualComputing2022-2/docs/excercises/toon.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>normal3</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>500</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorMode</span>(<span style=color:#a6e22e>RGB</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>textureMode</span>(<span style=color:#a6e22e>NORMAL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setAttributes</span>(<span style=color:#e6db74>&#39;antialias&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>300</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>0.285</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.257</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.619</span>, <span style=color:#ae81ff>0.685</span>],
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>.<span style=color:#a6e22e>INFO</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>//easycam.attachMouseListeners(this._renderer);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>state</span>, <span style=color:#ae81ff>2000</span>); <span style=color:#75715e>// now animate to that state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// suppress right-click context menu
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  document.<span style=color:#a6e22e>oncontextmenu</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trange</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>models</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>push</span>(
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>position</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>createVector</span>((<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>angle</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>random</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>TWO_PI</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>axis</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>random3D</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>25</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// gui
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>modelsDisplayed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span>, <span style=color:#66d9ef>int</span>(<span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>), <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.4</span>, <span style=color:#ae81ff>0.05</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depth</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depth</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>lightShader</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient&#39;</span>, <span style=color:#a6e22e>depth</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createColorPicker</span>(<span style=color:#e6db74>&#39;white&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>45</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ambient4Color</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ambient4</span>.<span style=color:#a6e22e>color</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient4&#39;</span>, [<span style=color:#a6e22e>red</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#a6e22e>green</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#a6e22e>blue</span>(<span style=color:#a6e22e>ambient4Color</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient4&#39;</span>, [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dirX</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dirY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>mouseY</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;lightNormal&#39;</span>, <span style=color:#a6e22e>createVector</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>dirX</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>dirY</span>, <span style=color:#a6e22e>depth</span>.<span style=color:#a6e22e>value</span>()).<span style=color:#a6e22e>array</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#39;green&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>axes</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>value</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>color</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>position</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotate</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>angle</span>, <span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>axis</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>cone</span>(<span style=color:#a6e22e>radius</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>sphere</span>(<span style=color:#a6e22e>radius</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>torus</span>(<span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>radius</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><details><summary>Toon shading fragment shader</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#66d9ef>precision</span> <span style=color:#66d9ef>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//uniform float ambient;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec4</span> ambient4;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec4</span> uMaterialColor;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec3</span> lightNormal;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec3</span> normal3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> intensity <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0.0</span>, dot(normalize(<span style=color:#f92672>-</span>lightNormal), normalize(normal3)));
</span></span><span style=display:flex><span>  <span style=color:#75715e>//float intensity = max(0.0, dot(direction3, normal3));</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> k <span style=color:#f92672>=</span> intensity <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.95</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>:</span> intensity <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>0.6</span> <span style=color:#f92672>:</span> intensity <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.25</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>0.4</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0.2</span>;
</span></span><span style=display:flex><span>  gl_FragColor <span style=color:#f92672>=</span> k <span style=color:#f92672>*</span> ambient4 <span style=color:#f92672>*</span> uMaterialColor;
</span></span><span style=display:flex><span>  <span style=color:#75715e>//gl_FragColor = (ambient + k) * ambient4 * uMaterialColor;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><h4 id=execution-1>Execution
<a class=anchor href=#execution-1>#</a></h4><iframe id=breath style=width:530px;height:530px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/objetos/p5.quadrille.js/p5.quadrille.js></script>
            <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            
            
            
            
            
            <script>
              
'use strict';

let easycam;
let models;
let modelsDisplayed;
let lightShader;
let depth, ambient4;

function preload() {
  lightShader = readShader('/VisualComputing2022-2/docs/excercises/toon.frag', { varyings: Tree.normal3 });
}

function setup() {
  createCanvas(500, 500, WEBGL);
  colorMode(RGB, 1);
  textureMode(NORMAL);
  noStroke();
  setAttributes('antialias', true);
  let state = {
    distance: 300,
    center: [0, 0, 0],
    rotation: [-0.285, -0.257, -0.619, 0.685],
  };
  console.log(Dw.EasyCam.INFO);
  easycam = new Dw.EasyCam(this._renderer);
  //easycam.attachMouseListeners(this._renderer);
  easycam.state_reset = state;   // state to use on reset (double-click/tap)
  easycam.setState(state, 2000); // now animate to that state
  // suppress right-click context menu
  document.oncontextmenu = function () { return false; }
  let trange = 100;
  models = [];
  for (let i = 0; i < 100; i++) {
    models.push(
      {
        position: createVector((random() * 2 - 1) * trange, (random() * 2 - 1) * trange, (random() * 2 - 1) * trange),
        angle: random(0, TWO_PI),
        axis: p5.Vector.random3D(),
        size: random() * 25 + 8,
        color: color(random(), random(), random())
      }
    );
  }
  // gui
  modelsDisplayed = createSlider(1, models.length, int(models.length / 4), 1);
  modelsDisplayed.position(10, 10);
  modelsDisplayed.style('width', '80px');
  depth = createSlider(-1, 1, -0.4, 0.05);
  depth.position(420, 10);
  depth.style('width', '80px');
  shader(lightShader);
  lightShader.setUniform('ambient', depth.value());
  ambient4 = createColorPicker('white');
  ambient4.position(420, 45);
  ambient4.input(() => {
    let ambient4Color = ambient4.color();
    lightShader.setUniform('ambient4', [red(ambient4Color) / 255, green(ambient4Color) / 255, blue(ambient4Color) / 255, 1]);
  });
  lightShader.setUniform('ambient4', [1, 1, 1, 1]);
}

function draw() {
  background(0);
  let dirX = (mouseX / width - 0.5) * 2;
  let dirY = (mouseY / height - 0.5) * 2;
  lightShader.setUniform('lightNormal', createVector(-dirX, -dirY, depth.value()).array());
  push();
  stroke('green');
  axes();
  grid();
  pop();
  for (let i = 0; i < modelsDisplayed.value(); i++) {
    push();
    fill(models[i].color);
    translate(models[i].position);
    rotate(models[i].angle, models[i].axis);
    let radius = models[i].size / 2;
    i % 3 === 0 ? cone(radius) : i % 3 === 1 ? sphere(radius) : torus(radius, radius / 4);
    pop();
  }
}

            </script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><blockquote class="book-hint info"><h3 id=specular-reflection>Specular reflection
<a class=anchor href=#specular-reflection>#</a></h3><p><strong>Excercise</strong><br>Implement a specular reflection scene producing a result like the sketch below:</blockquote><h2 id=code--results-2>Code & Results
<a class=anchor href=#code--results-2>#</a></h2><h4 id=code-2>Code
<a class=anchor href=#code-2>#</a></h4><p><details><summary>Specular reflection</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>easycam</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>models</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>modelsDisplayed</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lightShader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ambient</span> <span style=color:#75715e>/*, ambient4*/</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>point_light</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lightPath</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/VisualComputing2022-2/docs/excercises/specular.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>normal3</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>position4</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>500</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noLights</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorMode</span>(<span style=color:#a6e22e>RGB</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setAttributes</span>(<span style=color:#e6db74>&#39;antialias&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// define initial state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>300</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>0.285</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.257</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.619</span>, <span style=color:#ae81ff>0.685</span>],
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>.<span style=color:#a6e22e>INFO</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>easycam</span>.<span style=color:#a6e22e>setState</span>(<span style=color:#a6e22e>state</span>, <span style=color:#ae81ff>2000</span>); <span style=color:#75715e>// now animate to that state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  document.<span style=color:#a6e22e>oncontextmenu</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trange</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>models</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>100</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>push</span>(
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>position</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>createVector</span>((<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>, (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>trange</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>25</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>(), <span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// light
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>point_light</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>  <span style=color:#75715e>// gui
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>modelsDisplayed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span>, <span style=color:#66d9ef>int</span>(<span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>), <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSlider</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0.2</span>, <span style=color:#ae81ff>0.05</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;80px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>input</span>(() =&gt; { <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient&#39;</span>, <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>value</span>()) });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>lightShader</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;ambient&#39;</span>, <span style=color:#a6e22e>ambient</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightPath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSelect</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>//lightPath.option(&#39;0&#39;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;1&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;2&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;3&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>selected</span>(<span style=color:#e6db74>&#39;1&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pointLight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>updatePointLight</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resetShader</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#39;green&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>axes</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>grid</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>pointLight</span>.<span style=color:#a6e22e>position</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>//fill(point_light.color);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#39;white&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>lightShader</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>lightShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;uLightPosition&#39;</span>, <span style=color:#a6e22e>treeLocation</span>(<span style=color:#a6e22e>pointLight</span>.<span style=color:#a6e22e>position</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> }).<span style=color:#a6e22e>array</span>());
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>modelsDisplayed</span>.<span style=color:#a6e22e>value</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>color</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>position</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>models</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>box</span>(<span style=color:#a6e22e>radius</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>sphere</span>(<span style=color:#a6e22e>radius</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>torus</span>(<span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>radius</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updatePointLight</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>//if (lightPath.value() === &#39;0&#39;) return;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.03</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rad</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>px</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>angle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>rad</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>py</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>angle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>rad</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>angle</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>angle</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.02</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pz</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>frameCount</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.02</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>position</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>px</span>, <span style=color:#a6e22e>py</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>pz</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>40</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>pz</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>40</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>r</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>lightPath</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>r</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>g</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>g</span>)
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><details><summary>Specular reflection fragment shader</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=display:flex><span><span style=color:#66d9ef>precision</span> <span style=color:#66d9ef>mediump</span> <span style=color:#66d9ef>float</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>float</span> ambient;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec4</span> uMaterialColor;
</span></span><span style=display:flex><span><span style=color:#66d9ef>uniform</span> <span style=color:#66d9ef>vec3</span> uLightPosition;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec3</span> normal3;
</span></span><span style=display:flex><span><span style=color:#66d9ef>varying</span> <span style=color:#66d9ef>vec4</span> position4;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> main() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>vec3</span> direction3 <span style=color:#f92672>=</span> uLightPosition <span style=color:#f92672>-</span> position4.xyz;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>vec3</span> reflected3 <span style=color:#f92672>=</span> reflect(<span style=color:#f92672>-</span>direction3, normalize(normal3));
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>vec3</span> camera3 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>position4.xyz;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>float</span> specular <span style=color:#f92672>=</span> max(<span style=color:#ae81ff>0.0</span>, dot(normalize(reflected3), normalize(camera3)));
</span></span><span style=display:flex><span>  gl_FragColor <span style=color:#f92672>=</span> (ambient <span style=color:#f92672>+</span> specular) <span style=color:#f92672>*</span> uMaterialColor;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details></p><h4 id=execution-2>Execution
<a class=anchor href=#execution-2>#</a></h4><iframe id=breath style=width:530px;height:530px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/objetos/p5.quadrille.js/p5.quadrille.js></script>
            <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            
            
            
            
            
            <script>
              
'use strict';

let easycam;
let models;
let modelsDisplayed;
let lightShader;
let ambient /*, ambient4*/;
let point_light;
let lightPath;

function preload() {
  lightShader = readShader('/VisualComputing2022-2/docs/excercises/specular.frag', { varyings: Tree.normal3 | Tree.position4 });
}

function setup() {
  createCanvas(500, 500, WEBGL);
  noLights();
  colorMode(RGB, 1);
  setAttributes('antialias', true);
  // define initial state
  let state = {
    distance: 300,
    center: [0, 0, 0],
    rotation: [-0.285, -0.257, -0.619, 0.685],
  };
  console.log(Dw.EasyCam.INFO);
  easycam = new Dw.EasyCam(this._renderer);
  easycam.state_reset = state;   // state to use on reset (double-click/tap)
  easycam.setState(state, 2000); // now animate to that state
  document.oncontextmenu = function () { return false; }
  // models
  let trange = 100;
  models = [];
  for (let i = 0; i < 100; i++) {
    models.push(
      {
        position: createVector((random() * 2 - 1) * trange, (random() * 2 - 1) * trange, (random() * 2 - 1) * trange),
        size: random() * 25 + 8,
        color: color(random(), random(), random())
      }
    );
  }
  // light
  point_light = {};
  // gui
  modelsDisplayed = createSlider(1, models.length, int(models.length / 4), 1);
  modelsDisplayed.position(10, 10);
  modelsDisplayed.style('width', '80px');
  ambient = createSlider(0, 1, 0.2, 0.05);
  ambient.position(420, 10);
  ambient.style('width', '80px');
  ambient.input(() => { lightShader.setUniform('ambient', ambient.value()) });
  shader(lightShader);
  lightShader.setUniform('ambient', ambient.value());
  lightPath = createSelect();
  lightPath.position(10, 40);
  //lightPath.option('0');
  lightPath.option('1');
  lightPath.option('2');
  lightPath.option('3');
  lightPath.selected('1');
}

function draw() {
  background(0);
  let pointLight = updatePointLight();
  resetShader();
  push();
  stroke('green');
  axes();
  grid();
  pop();
  push();
  translate(pointLight.position);
  noStroke();
  //fill(point_light.color);
  fill('white');
  sphere(3);
  pop();
  shader(lightShader);
  lightShader.setUniform('uLightPosition', treeLocation(pointLight.position, { from: Tree.WORLD, to: Tree.EYE }).array());
  for (let i = 0; i < modelsDisplayed.value(); i++) {
    push();
    noStroke();
    fill(models[i].color);
    translate(models[i].position);
    let radius = models[i].size / 2;
    i % 3 === 0 ? box(radius * 2) : i % 3 === 1 ? sphere(radius) : torus(radius, radius / 4);
    pop();
  }
}

function updatePointLight() {
  //if (lightPath.value() === '0') return;
  let angle = frameCount * 0.03;
  let rad = 30;
  let px = cos(angle) * rad;
  let py = sin(angle) * rad;
  let r = (sin(angle) * 0.5 + 0.5);
  let g = (sin(angle * 0.5 + PI / 2) * 0.5 + 0.5);
  let b = (sin(frameCount * 0.02) * 0.5 + 0.5);
  let pz = sin(frameCount * 0.02);
  return {
    position: lightPath.value() === '1' ? createVector(px, py, 0) : lightPath.value() === '2' ?
      createVector(50, 50, pz * 40) : createVector(-50, -50, -pz * 40),
    color: lightPath.value() === '1' ? color(1 - r, r / 2, r) : lightPath.value() === '2' ?
      color(r, 1, g) : color(1, r, g)
  };
}

            </script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=conclusions>Conclusions
<a class=anchor href=#conclusions>#</a></h2><p>The correct inclusion of light is one of the most important factors to make a scene, both photorealistic and non-photorealistic, seem more vivid, alive, and interactive. The inclusion of light in computer graphics isn&rsquo;t a one-size-fits-all approach. Different situations require the use of different lighting models to more adequately convey the environment we want to present. Understanding these models is key to presenting vivid and interesting scene to our users.</p><p>In terms of future work, analyzing and implementing different behaviors for light when it bounces on different materials would be a great step in creating immersive experiences. Creating a repository with all of their reflective characteristics under different lighting models would help build these kinds of applications faster and with a more consistent behavior all around. Furthermore, translucid materials present another challenge in our implementation of light, given that they modify the light as it goes through them. Modeling their behavior in such a way that it is reasonably simple to implemnent it for different lighting models would allow for mo complex worlds and scenarios to be developed.</p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://visualcomputing.github.io/docs/shaders/lighting/>Visual Computing - Lighting</a></li><li><a href=https://github.com/freshfork/p5.EasyCam/blob/master/examples/RandomBoxes/RandomBoxes.js>p5.EasyCam - Random Boxes Examples</a></li><li><a href=https://www.cs.uic.edu/~jbell/CourseNotes/ComputerGraphics/LightingAndShading.html>Lighting and Shading</a>, University of Illinois, Chicago</li><li><a href=https://www.pluralsight.com/blog/film-games/understanding-different-light-types>Understanding Different Light Types</a>, Pluralsight</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/AndresRPerez12/VisualComputing2022-2/commit/339f31d0f38e566b805d370a74d0ec1a15f096f3 title='Last modified by Andres Ricardo Perez Rojas | November 28, 2022' target=_blank rel=noopener><img src=/VisualComputing2022-2/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 28, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#excercises-lighting>Excercises: Lighting</a><ul><li><a href=#background>Background</a><ul><li><a href=#no-lighting-emissive-lighting>No Lighting (Emissive Lighting)</a></li><li><a href=#ambient-light>Ambient Light</a></li><li><a href=#point-light>Point Light</a></li><li><a href=#difuse-reflection>Difuse Reflection</a></li><li><a href=#specular-reflection>Specular Reflection</a></li></ul></li><li><a href=#code--results>Code & Results</a><ul><li></li></ul></li><li><a href=#code--results-1>Code & Results</a><ul><li></li></ul></li><li><a href=#code--results-2>Code & Results</a><ul><li></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></aside></main></body></html>